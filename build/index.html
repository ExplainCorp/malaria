<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Malaria</title>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:700,300,400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
  <script src="js/d3.v3.min.js" charset="utf-8"></script>
  <script src="js/tabletop.js"></script>
  <link rel="stylesheet" href="css/reset.css">
  <style type="text/css">
  body { font-family: 'Open Sans', 'Helvetica', 'Arial', sans-serif;font-size:16px;}
  #landing-page { margin-top:50px;display:none;}
  #landing-page #landing-header { width:740px;margin:0px auto;text-align: center}
  #landing-page h1 { font-size:40px;color:#22B573;margin-bottom:28px;}
  #landing-page h2 { font-size:16px;color:#777;line-height:28px;}
  #param-container { width:710px;margin:100px auto 35px auto;color:#777;}
  #param-container .all-params { margin-top:50px;}
  #param-container .all-params p { padding-right:15px;}
  #param-container .param-title { width:100px;float:left;text-align: right}
  #param-container .sliders { width:380px;float:left;}
  #param-container .value-ranges { width:100px;float:left;color:#22B573;}
  #param-container .value-ranges p { padding-left:20px;}
  #param-container .param-year { width:120px;float:left;}
  #param-title-text { text-align:center}
  .clear { clear:both;}
  .ui-selectmenu-button span.ui-selectmenu-text { padding:0px;line-height:15px;font-size:10px;}
  #country-container { width:300px;height:20px;margin:28px auto 0px auto;}
  #country-output-container { float:right;position:relative;right:50%;text-align:left;margin-top:10px;height:35px;}
  #country-output { position:relative;left:50%;margin-top:35px; }
  .countries-output { padding:15px 20px;background:#f7f7f7;font-size:18px;color:#555;margin-left:10px;float:left;position:relative;cursor:pointer;}
  .countries-output:hover { color:#222;background:#ddd;}
  .countries-output:first-child { margin-left:0px;}
  .countries-output .closer { position:absolute;top:-5px;right:-1px;width:6px;height:6px;color:#888;font-size:12px; }
  select[disabled] { color:#f7f7f7; }
  .dash-class { color:#ccc;}
  #landing-submit { padding:15px;font-size:18px;font-weight:bold;color:#555;border:1px solid silver;width:200px;text-align: center;margin:0px auto;cursor:pointer;}
  #landing-submit:hover { color:white;background-color:#22B573;}
  #landing-footer { width:200px;text-align:center;font-size:16px;line-height:22px;margin:50px auto;color:#777;}
  #landing-results-output-test { width:400px;font-size:18px;color:#555;text-align:center;margin:20px auto;}
  /** overwrite ui css **/
  #landing-page .ui-corner-all, .ui-corner-bottom, .ui-corner-right, .ui-corner-br { border-radius:0px;}
  #landing-page .ui-slider .ui-slider-handle {width:20px;height:20px;border-radius:50%;border:3px solid #22B573;}
  #landing-page .ui-slider { border:none;border-top:1px solid silver;margin-top:8px;}
  #landing-page .ui-slider-handle { margin-top:-8px;cursor:pointer;}
  #landing-page .ui-slider-range { background:#22B573;height:3px;margin-top:-2px;}
  #landing-page .ui-state-default, .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default { background:white;}
  #landing-page .ui-state-active { border:0px solid #22B573;}
  #landing-page .ui-selectmenu-button { padding:10px;}
  #param-container .ui-selectmenu-button { margin-top:-10px;}
  #country-container .ui-selectmenu-text { font-size:18px;}
  #country-container .ui-selectmenu-button { width:300px !important;}
  #country-container .ui-selectmenu-button span.ui-selectmenu-text { line-height:25px;}
  /** results viz **/
  #results-viz { width:1100px;margin:0px auto 100px auto;background:white;}
  #results-viz a { text-decoration: none;}
  #results-viz h2 a { color:#22b573;font-size:30px;font-weight:bold;}
  #results-viz .results-header-countries { margin-top:15px;}
  #results-viz h3 { font-size:50px;color:#4d4d4d;letter-spacing:-2px;}
  #results-nav-risks { margin:25px 0px;background:#f7f7f7;}
  #results-viz #nav-risks li { float:left;padding:15px 0px 15px 15px;background: #ccc;color:#555;margin-left:1px;cursor:pointer;font-size:16px;width:204px;margin-top:1px;}
  #results-viz #nav-risks li:hover { background:#bbb;color:#777;}
  #results-viz #nav-risks li:first-child, #results-viz #nav-risks li:nth-child(6) { margin-left:0px;}
  #results-viz #nav-risks li.risks-active { background:#777;color:#f5f5f5;}
  #results-viz #results-nav-left { width:145px;background:white;float:left;}
  #results-viz #results-nav-left p { font-size:17px;font-weight:bold;color:#4d4d4d;padding:15px 5px 15px 15px}
  #results-viz #nav-left {color:#666666;}
  #results-viz #nav-left li { padding:15px;display: inline-block;cursor:pointer;}
  #results-viz #nav-left li:hover { background:#22b573;color:white;border-radius:5px;}
  #results-viz #results-content { float:left;width:955px;background:white;}
  #results-viz .results-content-risk { background:white;margin-bottom:15px;position: relative;margin-left:15px;margin-right:35px;}
  #results-viz .results-content-risk .results-risks-title { position:absolute;top:15px;left:5px;font-size:12px;color:#777;}
  #results-viz .results-content-risk:first-child { margin-top:0px;height:600px;}
  #results-viz #nav-left .nav-left-active { background:#22b573;color:white;border-radius:5px;}
  /** d3 stuff **/
  .lines { stroke:#999;fill:none;stroke-width:3px;}
  .axis path,
  .axis line {
    fill: none;
    stroke: #ccc;
    stroke-width: 1px;
    shape-rendering: crispEdges;
  } 
  .tick line { stroke:#ccc;stroke-dasharray: 2, 5;}
  .tick:first-child line { display:none;}
  .axis .tick text { font-size:12px;fill:#666;}
  .axis .tick:first-child text { text-anchor:start !important;}
  .x .tick text { text-anchor:end !important;font-size:16px;}
  .y .domain { display:none;}
  .viz-risks { margin-left:25px;}
  /** cases death **/
  #results-viz #cases-death { width:1100px;height:300px;}
  #results-viz #cd-results-content { float:left;width:955px;background:white;}
  #results-viz #cd-nav-left { width:145px;background:white;float:left;}
  #results-viz #cd-nav-left p { font-size:17px;font-weight:bold;color:#4d4d4d;padding:15px 5px 15px 15px}
  #results-viz #cd-nav-left {color:#666666;}
  #results-viz #cd-nav-left li { padding:15px;display: inline-block;cursor:pointer;}
  #results-viz #cd-nav-left li:hover { background:#22b573;color:white;border-radius:5px;}
  #results-viz #viz_CD { margin-left:15px;margin-right:35px;position: relative; }
  #results-viz #cd-nav-left .cd-nav-left-active { background:#22b573;color:white;border-radius:5px;}

  </style>
  <script>
  $(document).ready(function() {

      // ** global variables **
      var params = {};
      var country_list = []; 
      var datarisk;
      var datariskCD;
      // ** global d3 variables
      var w,h,hCD,p;
      var viz, viz_int, vizCD;
        // create concentrated dataset for lines by removing params
      var labelVar = 'year';
      var param1 = 'intervention_index_PARAM';
      var param2 = 'development_index_PARAM';
      var param3 = 'vector_behavior_index_PARAM';
      var param4 = 'climate_index_PARAM';
      var param5 = 'transmission_index_PARAM';
      var risk1 = 'population_RISK_FACTOR';
      var risk2 = 'pop_at_risk_RISK_FACTOR';
      var risk3 = 'GDP_per_capita_RISK_FACTOR';
      var risk4 = 'funding_RISK_FACTOR';
      var risk5 = 'ALL_larval_control_RISK_FACTOR';
      var risk6 = 'ALL_nets_RISK_FACTOR';
      var risk7 = 'IRS_RISK_FACTOR';
      var risk8 = 'drugs_RISK_FACTOR';
      var risk9 = 'insecticide_resistance_RISK_FACTOR';
      var risk10 = 'drug_resistance_RISK_FACTOR';
      var mc = 'malaria_cases';
      var md = 'malaria_deaths';
      var viz_population_RISK_FACTOR;
      var viz_pop_at_risk_RISK_FACTOR;
      var viz_funding_RISK_FACTOR;
      var viz_GDP_per_capita_RISK_FACTOR;
      var viz_ALL_larval_control_RISK_FACTOR;
      var viz_ALL_nets_RISK_FACTOR;
      var viz_IRS_RISK_FACTOR;
      var viz_drugs_RISK_FACTOR;
      var viz_insecticide_resistance_RISK_FACTOR;
      var viz_drug_resistance_RISK_FACTOR;
      var format_date;
      var xpos;
      var ypos;
      var minDate, maxDate;
      var xAxis, yAxis;
      var seriesDataCD;
      var varNames, varNamesCD;

      // ** pull data from spreadsheet into json via tabletop.js
      var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1HmW1NzSwOg0F3zwsk2VHnAD00OHRKQykM_gFdrMF_UA/pubhtml';

      function initTabletop() {
        Tabletop.init( { key: public_spreadsheet_url,
                         callback: showInfo,
                         simpleSheet: false,
                         parseNumbers: false } )
      }

      function showInfo(data, tabletop) {
        console.log("Successfully processed!")
        // how to sort transmission index if no specific year is selected? Ask Derek

        // to do: 
        // data will load every sheet, write function to sort through sheets
        // active countries draw left-nav [done]
        console.log(data);
        datarisk = data;
        datariskCD = data;
        // temporary, comment this out when landing-page is visible
        visualize();
      }      

      // ** init param object and country list 
      function initParams() {
          for (i = 1; i <= 5; i++) {
              params["param" + i + "a"] = 40;
              params["param" + i + "b"] = 60;
              params["param" + i + "year"] = "yearsAll";
          }
        initSliders();
        initCountries();
        initTabletop();
      }

      // ** sliders
      function initSliders() {
        $(".sliders").each(function(n) {
            $(this).slider({
                range: true,
                min: 0,
                max: 100,
                values: [40, 60],
                slide: function(event, ui) {
                    $(".value-ranges p").eq(n).html(ui.values[0] + " <span class='dash-class'>&mdash;</span> " + ui.values[1]);
                    params["param" + (n + 1) + "a"] = ui.values[0];
                    params["param" + (n + 1) + "b"] = ui.values[1];
                    console.log(params)
                }
            });
        });
        $(".param-year").each(function(n) {
          $(this).selectmenu({
            change: function(event,data) {
              params["param" + (n + 1) + "year"] = data.item.value;
              console.log(params)
            }
          })
        })
      }

      // ** country drop down [done]
      // to do: if all countries -> deselect drop down [done]
      // to do: if something other than all countries -> deselect all countries [done]
      function initCountries() {
        $("#countries").selectmenu({
          change: function(event,data) {
            ctry = data.item.value;
            ctry_txt = data.item.label;
            country_list.push(ctry);
            $("#countries option[value="+ctry+"]").attr('disabled',true);
            $("#country-output").append("<div class='countries-output' id='"+ctry+"'>"+ctry_txt+"<div class='closer'>&#10006;</div>");
            if (country_list.length >= 1 && ctry!="All_Countries") {
              $("#countries option[value='All_Countries']").attr('disabled',true);
            }
            disableDD();
            checkCountryLength();
            $(this).selectmenu("refresh");            
          }
        }) 
        $("#country-output").on("click", ".countries-output", function(e) {
          e.preventDefault();
          get_ctry = $(this).attr("id");
          index = country_list.indexOf(get_ctry);
          if (index > -1) {
            country_list.splice(index, 1);
          }
          checkCountryLength();
          $(this).remove();
          if (country_list.length < 1) {
            $("#countries option[value='All_Countries']").attr('disabled',false);
          }
          $("#countries option[value=" + get_ctry + "]").attr('disabled',false);
          $("#countries").selectmenu("refresh");
        })          
      }

      // ** max 5 countries drop down
      function checkCountryLength() {
        if (country_list.length == 5) {
          console.log("yes")
          $("#countries").selectmenu().selectmenu("disable");  
        } else {
          console.log("no")
          $("#countries").selectmenu().selectmenu("enable");   
        }        
      }

      // disable if All Countries selected
      function disableDD() {
        if (ctry=="All_Countries") {
          $("#countries").selectmenu("disable");
        } else {
          $("#countries").selectmenu().selectmenu("enable"); 
        }
      }

      initParams();

      // to do: submit button has to check values are inputted
      // submit button goes here
      // keep submit disabled until a selection has been changed?

      $("#landing-submit").on("click", function(e) {
        e.preventDefault();
        if (country_list.length == 0) {
          country_list.push("All_Countries");
        }
        /* testing purposes
        $("#landing-results-output-test").html("Countries: "+country_list);
        for (p in params) {
          $("#landing-results-output-test").append("<div>"+p+" : "+params[p]);
        }
        */
        visualize();
      });

      // arrays for selected navigation items
      var risks_all = [];
      var cntrys_all = [];
      // to do: add labels to risk boxes at top left [done]
      $("#results-viz #nav-risks li").on("click", function(e) {
        e.preventDefault();
        $(this).toggleClass("risks-active");
        navEvents();
        if (get_risk_cnt == 0) $(this).addClass("risks-active")
      })

      function navEvents(navActive) {
        // reset arrays on every click
        risks_all.length = 0;
        cntrys_all.length = 0;

        get_risk_cnt = $("#results-viz #nav-risks .risks-active").length;
        get_cnty_cnt = $("#results-viz #nav-left .nav-left-active").length;

        $("#results-viz #nav-risks .risks-active").each(function(i) {
          idx = $(this).index();
          risks = $("#results-viz #nav-risks li").eq(idx).attr("id").split("risks-")[1];
          risks_all.push(risks);
        });
        $("#results-viz #nav-left .nav-left-active").each(function(j) {
          cntrys = $("#results-viz .nav-left-active").eq(j).attr("id");
          cntrys_all.push(cntrys);
        });        

        divideSpaces(risks_all, get_risk_cnt, cntrys_all);

        // this area is for drawing cases/deaths for selected countries
        $("#results-viz .cd-results-content-risk").html("");
        createSVG_CD(cntrys_all);
      }

      function divideSpaces(risks,count,countries) {
        $("#results-viz #results-content").html("");
        // set height of first div that divides
        set_height = 600;
        if (count<=5) {
          risks_height = set_height/count;
        } else {
          risks_height = set_height/5;
        }
        
        // get risk count and create separate svgs
        for(i=0;i<count;i++) {
          get_title = $("#results-viz #nav-risks li#risks-"+risks_all[i]).text();

          $("#results-viz #results-content").append("<div id='"+risks_all[i]+"' class='results-content-risk' style='height:"+risks_height+"px'><div class='results-risks-title'>"+get_title+"</div></div>")
            createSVG(risks_all[i], risks_height, count);        
        }

        // call risks viz function here
        for(j=0;j<countries.length;j++) {
          for(k=0;k<risks_all.length;k++) {
            graph_risks(datarisk[countries[j]].elements, risks_all[k], risks_height, countries[j], count)
          }
        }        
      }

      // draw left-nav based off country_list or param filters w/ All Countries
      // first draw it off of country_list [done]
      // after draw it off of all_countries + params
      function drawNav(countries) {
        //console.log(countries.length)
        $("#results-viz #nav-left").html("");
        for (i=0;i<countries.length;i++) {
          $("#results-viz #nav-left").append("<li id="+countries[i]+">"+countries[i]+"</li>")
        }
        navLeftEvents();

      }

      function navLeftEvents() {
        $("#results-nav-left #nav-left li").eq(0).addClass("nav-left-active");
        //console.log(datarisk["Brazil"].elements)
        // call first graph here
        navEvents("Brazil");

        $("#results-nav-left #nav-left li").on("click", function(e) {
          e.preventDefault();
          $(this).toggleClass("nav-left-active");

          // update to id instead of text when data structure is complete
          get_ctry = $(this).text();
          navEvents(get_ctry);
          if (get_cnty_cnt == 0) $(this).addClass("nav-left-active");

        });
      }
      // ^-- come back to this, work on setting up  
      // and integrating data for 1 country first w/ all risks

      function visualize() {
        // for testing purposes just have three countries here
        country_list = [];
        country_list.push("Brazil");
        country_list.push("Congo");
        country_list.push("Chad");
        drawNav(country_list);

      }

      // risk svg's are separate to avoid duplicates
      function createSVG(riskID, h2, count) {
        p = 25; // padding
        w = 955;
        h = h2;
        viz = d3.select("#results-content #"+riskID).append("svg")
          .attr("width", w)
          .attr("height", h)
          .attr("id", "viz_"+riskID)
          .attr("class", "viz-visks")

        viz.append("rect")
          .attr("width", w-(p*2))
          .attr("height", h-(p+5))
          .attr("y", 5)
          .attr("class", "background-class")
          .style("fill", "#f2f2f2")

        format_date = d3.time.format("%Y").parse; 

        minDate = new Date("1/1/1898");
        // temporary, pull from sheet
        maxDate = new Date("1/1/2014");

        xpos = d3.time.scale()
          .domain([minDate,maxDate])
          .range([0, w-(p*2)]);

        ypos = d3.scale.linear()
          .domain([0,100])
          .range([h-p,5]);      

        xAxis = d3.svg.axis()
            .scale(xpos)
            .orient("bottom")
            .tickValues([minDate,maxDate])
            .tickFormat(d3.time.format("%Y"))
            .tickSize(0,0)

        if (count == 1) {
          yTicks = ["0","10","20","30","40","50","60","70","80","90","100"];
        } else if (count < 4) {
          yTicks = ["0","50","100"];
        } else {
          yTicks = ["0","100"];
        }

        yAxis = d3.svg.axis()
            .scale(ypos)
            .orient("right")
            .tickValues(yTicks)
            .tickSize(-(w-(p*2)),0)

        all_axis = d3.select("#results-content #viz_"+riskID);
        
        all_axis.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + (h2-(p)) + ")")
            .call(xAxis)
            .selectAll("text")
            .attr("y", "10px");
        
        all_axis.append("g")
            .attr("class", "y axis")
            .attr("transform", "translate("+(w-(p*2))+",0)")
            .call(yAxis)
            .selectAll("text")
            .attr("x", "10px")

          modifyLabels();
      }

      // typographic adjustments on the labels
      function modifyLabels() {
        d3.selection.prototype.first = function() {
          return d3.select(this[0][0]);
        };
        d3.selection.prototype.last = function() {
          var last = this.size() - 1;
          return d3.select(this[0][last]);
        };

        var tickLabels = all_axis.selectAll('.y .tick text');

        tickLabels.first()
          .attr('transform','translate(0,-5)');
        tickLabels.last()
          .attr('transform','translate(0,7)');        
      }

      // visualize risks
      function graph_risks(data,risksID,h2,country,count) {      

        varNames = d3.keys(data[0]).filter(function (key) { return key !== labelVar && key != param1 && key != param2 && key != param3 && key != param4 && key != param5 && key != mc && key != md;});
                                                                    
        // target data
        // there might be a better way to do this, will revisit later
        if (risksID == "population_RISK_FACTOR") getidx = 0;         
        if (risksID == "pop_at_risk_RISK_FACTOR") getidx = 1;
        if (risksID == "funding_RISK_FACTOR") getidx = 2;
        if (risksID == "GDP_per_capita_RISK_FACTOR") getidx = 3;
        if (risksID == "ALL_larval_control_RISK_FACTOR") getidx = 4;
        if (risksID == "ALL_nets_RISK_FACTOR") getidx = 5;
        if (risksID == "IRS_RISK_FACTOR") getidx = 6;
        if (risksID == "drugs_RISK_FACTOR") getidx = 7;
        if (risksID == "insecticide_resistance_RISK_FACTOR") getidx = 8;
        if (risksID == "drug_resistance_RISK_FACTOR") getidx = 9;

        var seriesData = varNames.map(function (name) {
          return {
            name: name,
            values: data.map(function (d) {
              return {name: name, label: d[labelVar], value: +d[name]};
            })
          };
        });
   
        newdata = seriesData[getidx];
        //console.log(newdata)

        var line = d3.svg.line()
          .interpolate("monotone")
          .x(function (d) { return xpos(format_date(d.label));  })
          .y(function (d) { return ypos(d.value); });

        var series = d3.select("#results-content #viz_"+risksID)
          .datum(newdata)
          .append("path")
          .attr("class", "lines")
          .attr("id", function(d) { return "line-"+country+"-"+d.name })
          .attr("d", function (d) { return line(d.values); })

        var series_text = d3.select("#results-content #viz_"+risksID)
          .datum(newdata)
          .append("text")
          .attr("x", 5)
          .attr("y", function(d) { return ypos(d.values[0].value)-10 })
          .text(country)

        
        /*
        get_risk_cnt = $("#results-viz #nav-risks .risks-active");

        get_risk_cnt.each(function (s) {
          //activate
          init_line = $(this).attr("id").replace("risks-","line-");
          $("#results-viz #"+init_line).show();
        })
        */
      // if leftnav active = 1 but risks > 1, stay on large window [done]
      // next, when multiple countries and risks are selected, 
      // will need to redraw  dynamically create svgs inside divs [done]

      // ** to do
      // add axis [done]
      // new: call axis only once per risk, currently multiple [done]
      // axis style + dynamic y-axis ticks [done]
      // cases and deaths [done]
      // cases and deaths fix svg and country multiple [done]
      // look into voroni hover [maybe]
      // hover/toggle interaction
      // nav bugs
      // colors
      // spreadsheet country/param integration, set of check loops

      }

      // create one svg for cases and deaths
      function createSVG_CD(countries) {
        p = 25; // padding
        w = 955;
        hCD = 300;
        count = 3;

        vizCD = d3.select("#results-viz .cd-results-content-risk").append("svg")
          .attr("width", w)
          .attr("height", hCD)
          .attr("id", "viz_CD");

        vizCD.append("rect")
          .attr("width", w-(p*2))
          .attr("height", hCD-(p+5))
          .attr("y", 5)
          .attr("class", "background-class")
          .style("fill", "#f2f2f2")

        yposCD = d3.scale.linear()
          .domain([0,100])
          .range([hCD-p,5]);   

        xAxis = d3.svg.axis()
            .scale(xpos)
            .orient("bottom")
            .tickValues([minDate,maxDate])
            .tickFormat(d3.time.format("%Y"))
            .tickSize(0,0)

        if (count == 1) {
          yTicks = ["0","10","20","30","40","50","60","70","80","90","100"];
        } else if (count < 4) {
          yTicks = ["0","50","100"];
        } else {
          yTicks = ["0","100"];
        }

        yAxisCD = d3.svg.axis()
            .scale(yposCD)
            .orient("right")
            .tickValues(yTicks)
            .tickSize(-(w-(p*2)),0)

        all_axisCD = d3.select("#cd-results-content #viz_CD");
        
        all_axisCD.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + (hCD-(p)) + ")")
            .call(xAxis)
            .selectAll("text")
            .attr("y", "10px");
        
        all_axisCD.append("g")
            .attr("class", "y axis")
            .attr("transform", "translate("+(w-(p*2))+",0)")
            .call(yAxisCD)
            .selectAll("text")
            .attr("x", "10px")

          modifyLabels();      

        // draw cases and deaths lines
        for(j=0;j<countries.length;j++) {
         viz_CD(datariskCD[countries[j]].elements, countries[j]);
        }  
        
      }

      // visualize cases and deaths
      function viz_CD(data, country) {

        // create new data w/ just cases and deaths
        var varNamesCD = d3.keys(data[0]).filter(function (keyCD) { return keyCD !== labelVar && keyCD != param1 && keyCD != param2 && keyCD != param3 && keyCD != param4 && keyCD != param5 && keyCD != risk1 && keyCD != risk2 && keyCD != risk3 && keyCD != risk4 && keyCD != risk5 && keyCD != risk6 && keyCD != risk7 && keyCD != risk8 && keyCD != risk9 && keyCD != risk10; });

        var seriesDataCD = varNamesCD.map(function (name) {
          return {
            name: name,
            values: data.map(function (d) {
              return {name: name, label: d[labelVar], value: +d[name]};
            })
          };
        });

        var line = d3.svg.line()
          .interpolate("monotone")
          .x(function (d) { return xpos(format_date(d.label));  })
          .y(function (d) { return yposCD(d.value); });

        // cases path
        var seriesCD_c = d3.select("#cd-results-content #viz_CD")
          .datum(seriesDataCD[0])
          .append("path")
          .attr("class", function(d) { return "lines lines-cd cd-"+d.name})
          .attr("id", function(d) { return "cd-"+d.name+"-"+country })
          .attr("d", function (d) { return line(d.values) })

        // deaths path
        var seriesCD_d = d3.select("#cd-results-content #viz_CD")
          .datum(seriesDataCD[1])
          .append("path")
          .attr("class", function(d) { return "lines lines-cd cd-"+d.name})
          .attr("id", function(d) { return "cd-"+d.name+"-"+country })
          .attr("d", function (d) { return line(d.values) })

          navEventsCD("Cases");

        var series_text = d3.select("#cd-results-content #viz_CD")
          .datum(seriesDataCD[0])
          .append("text")
          .attr("x", 5)
          .attr("y", function(d) { return yposCD(d.values[0].value)-10 })
          .text(country)

      }

      $("#results-viz #cd-nav-left li").on("click", function(e) {
        e.preventDefault();
        $("#results-viz #cd-nav-left li").removeClass("cd-nav-left-active");
        $(this).toggleClass("cd-nav-left-active");
        getCDid = $(this).text();
        navEventsCD(getCDid);
      })

      function navEventsCD(getCDid) {
        $("#results-viz .lines-cd").hide();

        if (getCDid == "Cases") {
          $("#results-viz .cd-malaria_cases").show(); 
          $("#results-viz .cd-malaria_deaths").hide();  
        } else if (getCDid == "Deaths") {
          $("#results-viz .cd-malaria_cases").hide();
          $("#results-viz .cd-malaria_deaths").show();   
        } else {
          $("#results-viz .cd-malaria_cases").show();
          $("#results-viz .cd-malaria_deaths").show();             
        }


      }



  });
  </script>
</head>
<body>
  <div id="landing-page">
    <div id="landing-header">
      <h1>Malaria Data Visualization Tool</h1>
      <h2>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam suscipit consequat scelerisque. Sed id facilisis est. Vestibulum sagittis diam quis arcu vehicula, ac luctus risus faucibus. Sed sed diam at nunc gravida scelerisque. Nam sed arcu at tortor sollicitudin imperdiet. Cras facilisis neque mi, quis lacinia nulla egestas in. Aenean vitae leo finibus, placerat nibh quis, consequat leo. Etiam augue dui, vestibulum nec viverra nec, molestie ut turpis. Mauris sit amet nibh.</h2>
    </div>

    <!-- placeholder, wait for 100-country list :: generate from spreadsheet -->
    <div id="country-container">
      <select id="countries" name="countries">
        <option selected disabled>Choose up to 5 countries</option>
        <option value="All_Countries">All Countries</option>
        <option value="Afghanistan">Afghanistan</option>
        <option value="Albania">Albania</option>
        <option value="Algeria">Algeria</option>
        <option value="American_Samoa">American Samoa</option>
        <option value="Andorra">Andorra</option>
        <option value="Angola">Angola</option>
        <option value="Anguilla">Anguilla</option>
        <option value="Antarctica">Antarctica</option>
        <option value="Antigua_And_Barbuda">Antigua and Barbuda</option>
        <option value="Argentina">Argentina</option>
        <option value="Armenia">Armenia</option>
        <option value="Aruba">Aruba</option>
        <option value="Australia">Australia</option>
        <option value="Austria">Austria</option>
        <option value="Azerbaijan">Azerbaijan</option>
        <option value="Bahamas">Bahamas</option>
        <option value="Bahrain">Bahrain</option>
        <option value="Bangladesh">Bangladesh</option>
        <option value="Barbados">Barbados</option>
        <option value="Belarus">Belarus</option>
        <option value="Belgium">Belgium</option>
        <option value="Belize">Belize</option>
        <option value="Benin">Benin</option>
        <option value="Bermuda">Bermuda</option>
        <option value="Bhutan">Bhutan</option>
        <option value="Bolivia">Bolivia</option>
        <option value="Bosnia_And_Herzegovina">Bosnia and Herzegovina</option>
        <option value="Botswana">Botswana</option>
        <option value="Bouvet_Island">Bouvet Island</option>
        <option value="Brazil">Brazil</option>
        <option value="Brunei_Darussalam">Brunei Darussalam</option>
        <option value="Bulgaria">Bulgaria</option>
        <option value="Burkina_Faso">Burkina Faso</option>
        <option value="Burundi">Burundi</option>
        <option value="Cambodia">Cambodia</option>
        <option value="Cameroon">Cameroon</option>
        <option value="Canada">Canada</option>
        <option value="Cape_Verde">Cape Verde</option>
        <option value="Cayman_Islands">Cayman Islands</option>
        <option value="Central_African_Republic">Central African Republic</option>
        <option value="Chad">Chad</option>
        <option value="Chile">Chile</option>
        <option value="China">China</option>
        <option value="Christmas_Island">Christmas Island</option>
        <option value="Colombia">Colombia</option>
        <option value="Comoros">Comoros</option>
        <option value="Congo">Congo</option>
        <option value="Cook_Islands">Cook Islands</option>
        <option value="Costa_Rica">Costa Rica</option>
        <option value="Cote_D'ivoire">Cote D'ivoire</option>
        <option value="Croatia">Croatia</option>
        <option value="Cuba">Cuba</option>
        <option value="Cyprus">Cyprus</option>
        <option value="Czech_Republic">Czech Republic</option>
        <option value="Denmark">Denmark</option>
        <option value="Djibouti">Djibouti</option>
        <option value="Dominica">Dominica</option>
        <option value="Dominican_Republic">Dominican Republic</option>
        <option value="Ecuador">Ecuador</option>
        <option value="Egypt">Egypt</option>
        <option value="El_Salvador">El Salvador</option>
        <option value="Equatorial_Guinea">Equatorial Guinea</option>
        <option value="Eritrea">Eritrea</option>
        <option value="Estonia">Estonia</option>
        <option value="Ethiopia">Ethiopia</option>
        <option value="Faroe_Islands">Faroe Islands</option>
        <option value="Fiji">Fiji</option>
        <option value="Finland">Finland</option>
        <option value="France">France</option>
        <option value="French_Guiana">French Guiana</option>
        <option value="French_Polynesia">French Polynesia</option>
        <option value="French_Southern_Territories">French Southern Territories</option>
        <option value="Gabon">Gabon</option>
        <option value="Gambia">Gambia</option>
        <option value="Georgia">Georgia</option>
        <option value="Germany">Germany</option>
        <option value="Ghana">Ghana</option>
        <option value="Gibraltar">Gibraltar</option>
        <option value="Greece">Greece</option>
        <option value="Greenland">Greenland</option>
        <option value="Grenada">Grenada</option>
        <option value="Guadeloupe">Guadeloupe</option>
        <option value="Guam">Guam</option>
        <option value="Guatemala">Guatemala</option>
        <option value="Guernsey">Guernsey</option>
        <option value="Guinea">Guinea</option>
        <option value="Guinea-bissau">Guinea-bissau</option>
        <option value="Guyana">Guyana</option>
        <option value="Haiti">Haiti</option>
        <option value="Honduras">Honduras</option>
        <option value="Hong_Kong">Hong Kong</option>
        <option value="Hungary">Hungary</option>
        <option value="Iceland">Iceland</option>
        <option value="India">India</option>
        <option value="Indonesia">Indonesia</option>
        <option value="Iran,_Islamic_Republic_Of">Iran, Islamic Republic of</option>
        <option value="Iraq">Iraq</option>
        <option value="Ireland">Ireland</option>
        <option value="Isle_Of_Man">Isle of Man</option>
        <option value="Israel">Israel</option>
        <option value="Italy">Italy</option>
        <option value="Jamaica">Jamaica</option>
        <option value="Japan">Japan</option>
        <option value="Jersey">Jersey</option>
        <option value="Jordan">Jordan</option>
        <option value="Kazakhstan">Kazakhstan</option>
        <option value="Kenya">Kenya</option>
        <option value="Kiribati">Kiribati</option>
        <option value="Korea,_Republic_Of">Korea, Republic of</option>
        <option value="Kuwait">Kuwait</option>
        <option value="Kyrgyzstan">Kyrgyzstan</option>
        <option value="Latvia">Latvia</option>
        <option value="Lebanon">Lebanon</option>
        <option value="Lesotho">Lesotho</option>
        <option value="Liberia">Liberia</option>
        <option value="Libyan_Arab_Jamahiriya">Libyan Arab Jamahiriya</option>
        <option value="Liechtenstein">Liechtenstein</option>
        <option value="Lithuania">Lithuania</option>
        <option value="Luxembourg">Luxembourg</option>
        <option value="Macao">Macao</option>
        <option value="Madagascar">Madagascar</option>
        <option value="Malawi">Malawi</option>
        <option value="Malaysia">Malaysia</option>
        <option value="Maldives">Maldives</option>
        <option value="Mali">Mali</option>
        <option value="Malta">Malta</option>
        <option value="Marshall_Islands">Marshall Islands</option>
        <option value="Martinique">Martinique</option>
        <option value="Mauritania">Mauritania</option>
        <option value="Mauritius">Mauritius</option>
        <option value="Mayotte">Mayotte</option>
        <option value="Mexico">Mexico</option>
        <option value="Moldova,_Republic_Of">Moldova, Republic of</option>
        <option value="Monaco">Monaco</option>
        <option value="Mongolia">Mongolia</option>
        <option value="Montenegro">Montenegro</option>
        <option value="Montserrat">Montserrat</option>
        <option value="Morocco">Morocco</option>
        <option value="Mozambique">Mozambique</option>
        <option value="Myanmar">Myanmar</option>
        <option value="Namibia">Namibia</option>
        <option value="Nauru">Nauru</option>
        <option value="Nepal">Nepal</option>
        <option value="Netherlands">Netherlands</option>
        <option value="Netherlands_Antilles">Netherlands Antilles</option>
        <option value="New_Caledonia">New Caledonia</option>
        <option value="New_Zealand">New Zealand</option>
        <option value="Nicaragua">Nicaragua</option>
        <option value="Niger">Niger</option>
        <option value="Nigeria">Nigeria</option>
        <option value="Niue">Niue</option>
        <option value="Norfolk_Island">Norfolk Island</option>
        <option value="Northern_Mariana_Islands">Northern Mariana Islands</option>
        <option value="Norway">Norway</option>
        <option value="Oman">Oman</option>
        <option value="Pakistan">Pakistan</option>
        <option value="Palau">Palau</option>
        <option value="Panama">Panama</option>
        <option value="Papua_New_Guinea">Papua New Guinea</option>
        <option value="Paraguay">Paraguay</option>
        <option value="Peru">Peru</option>
        <option value="Philippines">Philippines</option>
        <option value="Pitcairn">Pitcairn</option>
        <option value="Poland">Poland</option>
        <option value="Portugal">Portugal</option>
        <option value="Puerto_Rico">Puerto Rico</option>
        <option value="Qatar">Qatar</option>
        <option value="Reunion">Reunion</option>
        <option value="Romania">Romania</option>
        <option value="Russian_Federation">Russian Federation</option>
        <option value="Rwanda">Rwanda</option>
        <option value="Saint_Helena">Saint Helena</option>
        <option value="Saint_Kitts_And_Nevis">Saint Kitts and Nevis</option>
        <option value="Saint_Lucia">Saint Lucia</option>
        <option value="Saint_Pierre_And_Miquelon">Saint Pierre and Miquelon</option>
        <option value="Samoa">Samoa</option>
        <option value="San_Marino">San Marino</option>
        <option value="Sao_Tome_And_Principe">Sao Tome and Principe</option>
        <option value="Saudi_Arabia">Saudi Arabia</option>
        <option value="Senegal">Senegal</option>
        <option value="Serbia">Serbia</option>
        <option value="Seychelles">Seychelles</option>
        <option value="Sierra_Leone">Sierra Leone</option>
        <option value="Singapore">Singapore</option>
        <option value="Slovakia">Slovakia</option>
        <option value="Slovenia">Slovenia</option>
        <option value="Solomon_Islands">Solomon Islands</option>
        <option value="Somalia">Somalia</option>
        <option value="South_Africa">South Africa</option>
        <option value="Spain">Spain</option>
        <option value="Sri_Lanka">Sri Lanka</option>
        <option value="Sudan">Sudan</option>
        <option value="Suriname">Suriname</option>
        <option value="Svalbard_And_Jan_Mayen">Svalbard and Jan Mayen</option>
        <option value="Swaziland">Swaziland</option>
        <option value="Sweden">Sweden</option>
        <option value="Switzerland">Switzerland</option>
        <option value="Syrian_Arab_Republic">Syrian Arab Republic</option>
        <option value="Taiwan,_Province_Of_China">Taiwan, Province of China</option>
        <option value="Tajikistan">Tajikistan</option>
        <option value="Tanzania,_United_Republic_Of">Tanzania, United Republic of</option>
        <option value="Thailand">Thailand</option>
        <option value="Timor-leste">Timor-leste</option>
        <option value="Togo">Togo</option>
        <option value="Tokelau">Tokelau</option>
        <option value="Tonga">Tonga</option>
        <option value="Trinidad_And_Tobago">Trinidad and Tobago</option>
        <option value="Tunisia">Tunisia</option>
        <option value="Turkey">Turkey</option>
        <option value="Turkmenistan">Turkmenistan</option>
        <option value="Turks_And_Caicos_Islands">Turks and Caicos Islands</option>
        <option value="Tuvalu">Tuvalu</option>
        <option value="Uganda">Uganda</option>
        <option value="Ukraine">Ukraine</option>
        <option value="United_Arab_Emirates">United Arab Emirates</option>
        <option value="United_Kingdom">United Kingdom</option>
        <option value="United_States">United States</option>
        <option value="Uruguay">Uruguay</option>
        <option value="Uzbekistan">Uzbekistan</option>
        <option value="Vanuatu">Vanuatu</option>
        <option value="Venezuela">Venezuela</option>
        <option value="Viet_Nam">Viet Nam</option>
        <option value="Virgin_Islands,_British">Virgin Islands, British</option>
        <option value="Virgin_Islands,_U.S.">Virgin Islands, U.S.</option>
        <option value="Wallis_And_Futuna">Wallis and Futuna</option>
        <option value="Western_Sahara">Western Sahara</option>
        <option value="Yemen">Yemen</option>
        <option value="Zambia">Zambia</option>
        <option value="Zimbabwe">Zimbabwe</option>
      </select>
    </div>
    <!-- selected countries go here -->
    <div id="country-output-container">
      <div id="country-output"></div>
    </div>
    <div class="clear"></div>
    
    <!-- parameter block -->
    <div id="param-container">
      <div id="param-title-text">
        <p>Use sliders to filter</p>
      </div>
      <div id="param-one" class="all-params">
        <div class="param-title"><p>Param</p></div>
        <div class="sliders" id="slider-range-one"></div>
        <div class="value-ranges" id="value-range-one"><p>40 <span class="dash-class">&mdash;</span> 60</p></div>
        <select name="number" id="param-year-one" class="param-year">
          <option value="yearsAll" value="yearsAll" selected="selected">All years</option>
          <option value="years1900to1910">1900 &mdash; 1910</option>
          <option value="years1911to1920">1911 &mdash; 1920</option>
          <option value="years1921to1930">1921 &mdash; 1930</option>
          <option value="years1931to1940">1931 &mdash; 1940</option>
          <option value="years1941to1950">1941 &mdash; 1950</option>
          <option value="years1951to1960">1951 &mdash; 1960</option>
          <option value="years1961to1970">1961 &mdash; 1970</option>    
          <option value="years1971to1980">1971 &mdash; 1980</option>
          <option value="years1981to1990">1981 &mdash; 1990</option>
          <option value="years1991to2000">1991 &mdash; 2000</option>
          <option value="years2001to2005">2001 &mdash; 2005</option>
          <option value="years2006to2010">2006 &mdash; 2010</option>
          <option value="years2011to2014">2011 &mdash; 2014</option>
        </select>
        <div class="clear"></div>
      </div>

      <div id="param-two" class="all-params">
        <div class="param-title"><p>Param</p></div>
        <div class="sliders" id="slider-range-two"></div>
        <div class="value-ranges" id="value-range-two"><p>40 <span class="dash-class">&mdash;</span> 60</p></div>
        <select name="number" id="param-year-two" class="param-year">
          <option value="yearsAll" selected="selected">All years</option>
          <option value="years1900to1910">1900 &mdash; 1910</option>
          <option value="years1911to1920">1911 &mdash; 1920</option>
          <option value="years1921to1930">1921 &mdash; 1930</option>
          <option value="years1931to1940">1931 &mdash; 1940</option>
          <option value="years1941to1950">1941 &mdash; 1950</option>
          <option value="years1951to1960">1951 &mdash; 1960</option>
          <option value="years1961to1970">1961 &mdash; 1970</option>    
          <option value="years1971to1980">1971 &mdash; 1980</option>
          <option value="years1981to1990">1981 &mdash; 1990</option>
          <option value="years1991to2000">1991 &mdash; 2000</option>
          <option value="years2001to2005">2001 &mdash; 2005</option>
          <option value="years2006to2010">2006 &mdash; 2010</option>
          <option value="years2011to2014">2011 &mdash; 2014</option>
        </select>
        <div class="clear"></div>
      </div>

      <div id="param-three" class="all-params">
        <div class="param-title"><p>Param</p></div>
        <div class="sliders" id="slider-range-three"></div>
        <div class="value-ranges" id="value-range-three"><p>40 <span class="dash-class">&mdash;</span> 60</p></div>
        <select name="number" id="param-year-three" class="param-year">
          <option value="yearsAll" selected="selected">All years</option>
          <option value="years1900to1910">1900 &mdash; 1910</option>
          <option value="years1911to1920">1911 &mdash; 1920</option>
          <option value="years1921to1930">1921 &mdash; 1930</option>
          <option value="years1931to1940">1931 &mdash; 1940</option>
          <option value="years1941to1950">1941 &mdash; 1950</option>
          <option value="years1951to1960">1951 &mdash; 1960</option>
          <option value="years1961to1970">1961 &mdash; 1970</option>    
          <option value="years1971to1980">1971 &mdash; 1980</option>
          <option value="years1981to1990">1981 &mdash; 1990</option>
          <option value="years1991to2000">1991 &mdash; 2000</option>
          <option value="years2001to2005">2001 &mdash; 2005</option>
          <option value="years2006to2010">2006 &mdash; 2010</option>
          <option value="years2011to2014">2011 &mdash; 2014</option>
        </select>
        <div class="clear"></div>
      </div>

      <div id="param-four" class="all-params">
        <div class="param-title"><p>Param</p></div>
        <div class="sliders" id="slider-range-four"></div>
        <div class="value-ranges" id="value-range-four"><p>40 <span class="dash-class">&mdash;</span> 60</p></div>
        <select name="number" id="param-year-four" class="param-year">
          <option value="yearsAll" selected="selected">All years</option>
          <option value="years1900to1910">1900 &mdash; 1910</option>
          <option value="years1911to1920">1911 &mdash; 1920</option>
          <option value="years1921to1930">1921 &mdash; 1930</option>
          <option value="years1931to1940">1931 &mdash; 1940</option>
          <option value="years1941to1950">1941 &mdash; 1950</option>
          <option value="years1951to1960">1951 &mdash; 1960</option>
          <option value="years1961to1970">1961 &mdash; 1970</option>    
          <option value="years1971to1980">1971 &mdash; 1980</option>
          <option value="years1981to1990">1981 &mdash; 1990</option>
          <option value="years1991to2000">1991 &mdash; 2000</option>
          <option value="years2001to2005">2001 &mdash; 2005</option>
          <option value="years2006to2010">2006 &mdash; 2010</option>
          <option value="years2011to2014">2011 &mdash; 2014</option>
        </select>
        <div class="clear"></div>
      </div>

      <div id="param-five" class="all-params">
        <div class="param-title"><p>Param</p></div>
        <div class="sliders" id="slider-range-five"></div>
        <div class="value-ranges" id="value-range-five"><p>40 <span class="dash-class">&mdash;</span> 60</p></div>
        <select name="number" id="param-year-five" class="param-year">
          <option value="yearsAll" selected="selected">All years</option>
          <option value="years1900to1910">1900 &mdash; 1910</option>
          <option value="years1911to1920">1911 &mdash; 1920</option>
          <option value="years1921to1930">1921 &mdash; 1930</option>
          <option value="years1931to1940">1931 &mdash; 1940</option>
          <option value="years1941to1950">1941 &mdash; 1950</option>
          <option value="years1951to1960">1951 &mdash; 1960</option>
          <option value="years1961to1970">1961 &mdash; 1970</option>    
          <option value="years1971to1980">1971 &mdash; 1980</option>
          <option value="years1981to1990">1981 &mdash; 1990</option>
          <option value="years1991to2000">1991 &mdash; 2000</option>
          <option value="years2001to2005">2001 &mdash; 2005</option>
          <option value="years2006to2010">2006 &mdash; 2010</option>
          <option value="years2011to2014">2011 &mdash; 2014</option>
        </select>
        <div class="clear"></div>
      </div>                
    </div>

    <div id="landing-submit">
      <p>View Results</p>
    </div>
    <div id="landing-results-output-test">
    </div>
    <div id="landing-footer">
      <p>By Derek Willis<br/>& Explain Corp.</p>
    </div>
  </div>

  <div id="results-viz">
    <div class="results-header">
      <h2><a href="/">Malaria Data Visualization Tool</a></h2>
      <div class="results-header-countries">
        <h3>Active Country</h3>
      </div>
    </div>
    <div id="results-nav-risks">
      <ul id="nav-risks">
        <li class="risks-active" id="risks-population_RISK_FACTOR">Total Population</li>
        <li id="risks-pop_at_risk_RISK_FACTOR">Population at risk</li>
        <li id="risks-funding_RISK_FACTOR">Funding*</li>
        <li id="risks-GDP_per_capita_RISK_FACTOR">GDP per capita*</li>
        <li id="risks-ALL_larval_control_RISK_FACTOR">Larval control</li>
        <li id="risks-ALL_nets_RISK_FACTOR">Insecticidal nets</li>
        <li id="risks-IRS_RISK_FACTOR">Indoor residual spraying</li>
        <li id="risks-drugs_RISK_FACTOR">Antimalarial drugs</li>
        <li id="risks-insecticide_resistance_RISK_FACTOR">Insecticide resistance</li>
        <li id="risks-drug_resistance_RISK_FACTOR">Drug resistance</li>
      </ul>
      <div class="clear"></div>
    </div>
    <div id="results-nav-left">
      <p>Select up to five countries</p>
      <ul id="nav-left">
        <li>Country one</li>
        <li>Country two</li>
        <li>Country thr</li>
        <li>Country fou</li>
        <li>Country fiv</li>
        <li>Country six</li>
      </ul>
      <div class="clear"></div>
    </div>
    <div id="results-content">
      <div class="results-content-risk"></div>
    </div>
    <div class="clear"></div>

    <div id="cases-deaths">
      <div id="cd-nav-left">
        <p>Cases and deaths</p>
        <ul id="cd-nav-left">
          <li class="cd-nav-left-active">Cases</li>
          <li>Deaths</li>
          <li>Both</li> 
        </ul>
        <div class="clear"></div>
      </div>
      <div id="cd-results-content">
        <div class="cd-results-content-risk"></div> 
      </div>
    <div class="clear"></div>      

    </div>
  </div>
</body>
</html>